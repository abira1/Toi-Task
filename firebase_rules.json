{
  "rules": {
    "users": {
      "$uid": {
        ".read": "auth.uid === $uid",
        ".write": "auth.uid === $uid",
        ".indexOn": ["createdAt", "completedAt"],
        
        "profile": {
          ".read": true,
          ".write": "auth.uid === $uid",
          
          "name": {
            ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length < 100"
          },
          "email": {
            ".validate": "newData.isString() && newData.val().matches(/.*@.*/)"
          },
          "avatar": {
            ".validate": "newData.isString() && (newData.val().length === 0 || newData.val().matches(/^https?:\\/\\/.*/i))"
          },
          "bio": {
            ".validate": "newData.isString() && newData.val().length < 500"
          },
          "expertise": {
            ".validate": "newData.hasChildren()"
          },
          "stats": {
            ".validate": "newData.hasChildren()",
            "tasksCompleted": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "streak": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "points": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            }
          }
        },
        
        "tasks": {
          ".read": "auth.uid === $uid",
          ".write": "auth.uid === $uid",
          ".indexOn": ["createdAt", "completed", "completedAt"],
          
          "$taskId": {
            "text": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length < 500"
            },
            "completed": {
              ".validate": "newData.isBoolean()"
            },
            "createdAt": {
              ".validate": "newData.isString()"
            },
            "completedAt": {
              ".validate": "!newData.exists() || newData.isString()"
            },
            "likes": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "userId": {
              ".validate": "newData.val() === auth.uid"
            },
            
            "comments": {
              ".read": "auth.uid === $uid",
              ".write": "auth.uid === $uid",
              ".indexOn": ["createdAt"],
              
              "$commentId": {
                "text": {
                  ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length < 500"
                },
                "userId": {
                  ".validate": "newData.isString()"
                },
                "createdAt": {
                  ".validate": "newData.isString()"
                }
              }
            }
          }
        }
      }
    },
    
    "teamMembers": {
      ".read": true,
      ".write": "root.child('admins').child(auth.uid).exists() === true",
      ".indexOn": ["createdAt", "email"],
      
      "$memberId": {
        "id": {
          ".validate": "newData.isString()"
        },
        "name": {
          ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length < 100"
        },
        "email": {
          ".validate": "newData.isString() && newData.val().matches(/.*@.*/)"
        },
        "avatar": {
          ".validate": "newData.isString() && (newData.val().length === 0 || newData.val().matches(/^https?:\\/\\/.*/i))"
        },
        "role": {
          ".validate": "newData.isString() && (newData.val() === 'admin' || newData.val() === 'user')"
        },
        "bio": {
          ".validate": "newData.isString() && newData.val().length < 500"
        },
        "expertise": {
          ".validate": "newData.hasChildren()"
        },
        "stats": {
          ".validate": "newData.hasChildren()",
          "tasksCompleted": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "streak": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "points": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          }
        },
        "createdAt": {
          ".validate": "newData.isString()"
        },
        "updatedAt": {
          ".validate": "!newData.exists() || newData.isString()"
        }
      }
    },
    
    "admins": {
      ".read": false,
      ".write": false,
      ".validate": "newData.isBoolean()"
    }
  }
}
